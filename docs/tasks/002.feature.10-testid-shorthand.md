# 002.feature.10: TestID Shorthand

**Status:** Pending
**Priority:** High (Quick Win)
**Complexity:** Low

## Objective

Add shorthand syntax for `data-testid` selectors to reduce typing and improve readability.

## Context

Currently, every testid selector requires verbose syntax:

```typescript
await sendCommand({ action: 'click', params: { selector: '[data-testid="submit-btn"]' } });
```

This is tedious and error-prone. A shorthand would significantly improve DX.

## Technical Details

### Option A: Helper Function

```typescript
// src/selectors.ts
export function testid(id: string): string {
  return `[data-testid="${id}"]`;
}

// Usage
import { testid } from 'puppet';
await sendCommand({ action: 'click', params: { selector: testid('submit-btn') } });
```

### Option B: Built-in `testid` Param

```typescript
// In session.ts processCommand, resolve testid param to selector
if (params.testid && !params.selector) {
  params.selector = `[data-testid="${params.testid}"]`;
}

// Usage - cleaner, no import needed
await sendCommand({ action: 'click', params: { testid: 'submit-btn' } });
```

### Option C: Smart Selector Resolution

```typescript
// Auto-detect selector type
function resolveSelector(selector: string): string {
  // Already a CSS selector
  if (selector.startsWith('.') || selector.startsWith('#') || selector.startsWith('[')) {
    return selector;
  }
  // Bare string = testid
  return `[data-testid="${selector}"]`;
}

// Usage
await sendCommand({ action: 'click', params: { selector: 'submit-btn' } });
```

### Recommendation

Implement **Option B** (testid param) AND **Option C** (smart resolution):

- Option B is explicit and type-safe
- Option C is convenient for simple cases
- Both can coexist

## Implementation

### Update types.ts

```typescript
interface CommandParams {
  selector?: string;
  testid?: string; // New: shorthand for data-testid
  // ... other params
}
```

### Update session.ts

Add selector resolution at the start of processCommand:

```typescript
// Resolve testid shorthand
if (params.testid && !params.selector) {
  params.selector = `[data-testid="${params.testid}"]`;
}

// Smart selector resolution (optional)
if (params.selector && !params.selector.match(/^[.#\[]/)) {
  params.selector = `[data-testid="${params.selector}"]`;
}
```

### Export Helper

```typescript
// src/selectors.ts
export const testid = (id: string) => `[data-testid="${id}"]`;

// src/index.ts
export { testid } from './selectors.js';
```

## Acceptance Criteria

- [ ] `testid` param works in all commands that accept selector
- [ ] `testid()` helper function exported from package
- [ ] Smart resolution treats bare strings as testids
- [ ] Explicit CSS selectors (., #, [) still work
- [ ] TypeScript types updated
- [ ] Documentation updated

## Testing

```typescript
// All of these should click [data-testid="submit"]
await sendCommand({ action: 'click', params: { testid: 'submit' } });
await sendCommand({ action: 'click', params: { selector: testid('submit') } });
await sendCommand({ action: 'click', params: { selector: 'submit' } }); // smart resolution

// These should work as normal CSS selectors
await sendCommand({ action: 'click', params: { selector: '#submit' } });
await sendCommand({ action: 'click', params: { selector: '.btn-primary' } });
await sendCommand({ action: 'click', params: { selector: '[name="submit"]' } });
```

## Documentation Update

Add to how-to-use-puppet.md:

```markdown
### Selector Shorthand

For `data-testid` selectors, you can use shorthand:

// Using testid param (recommended)
await sendCommand({ action: 'click', params: { testid: 'submit' } });

// Using helper function
import { testid } from 'puppet';
await sendCommand({ action: 'click', params: { selector: testid('submit') } });

// Smart resolution (bare string = testid)
await sendCommand({ action: 'click', params: { selector: 'submit' } });
```
