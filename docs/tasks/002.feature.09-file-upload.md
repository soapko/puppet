# 002.feature.09: File Upload Command

**Status:** Pending
**Priority:** Medium
**Complexity:** Low

## Objective

Add an `uploadFile` command to upload files via file input elements.

## Context

File uploads are a common interaction in web applications:

- Profile picture uploads
- Document submissions
- CSV/data imports
- Attachment handling

Currently users would need to use `evaluate` with complex workarounds. A dedicated command simplifies this.

## Technical Details

### Implementation Location

`src/session.ts` - add new command case

### Command Implementation

```typescript
case 'uploadFile':
  const uploadSelector = params.selector as string;
  const filePath = params.filePath as string | string[];

  // Find the file input
  const fileInput = await page.$(uploadSelector);
  if (!fileInput) {
    throw new Error(`File input not found: ${uploadSelector}`);
  }

  // Verify it's a file input
  const inputType = await fileInput.getAttribute('type');
  if (inputType !== 'file') {
    throw new Error(
      `Element is not a file input (type="${inputType}"): ${uploadSelector}`
    );
  }

  // Set the file(s)
  const files = Array.isArray(filePath) ? filePath : [filePath];
  await fileInput.setInputFiles(files);

  result = { uploaded: files };
  break;
```

### Parameters

| Param      | Type               | Description                         |
| ---------- | ------------------ | ----------------------------------- |
| `selector` | string             | Selector for the file input element |
| `filePath` | string \| string[] | Path(s) to file(s) to upload        |

### Handling Hidden File Inputs

Many UIs hide the actual file input and trigger it via a styled button. Playwright's `setInputFiles` works on hidden inputs, so this isn't a problem.

### Multiple File Upload

For inputs with `multiple` attribute, pass an array of file paths:

```javascript
{
  "action": "uploadFile",
  "params": {
    "selector": "input[type='file']",
    "filePath": ["/path/to/file1.pdf", "/path/to/file2.pdf"]
  }
}
```

## Acceptance Criteria

- [ ] `uploadFile` command sets file on input element
- [ ] Works with visible file inputs
- [ ] Works with hidden file inputs (styled upload buttons)
- [ ] Supports single file upload
- [ ] Supports multiple file upload (array of paths)
- [ ] Clear error if element not found
- [ ] Clear error if element is not a file input
- [ ] Result indicates which files were uploaded

## Testing

```javascript
// Navigate to page with file upload
await sendCommand({ action: 'goto', params: { url: 'https://app.com/settings' } });

// Upload single file
const result = await sendCommand({
  action: 'uploadFile',
  params: {
    selector: '[data-testid="avatar-upload"]',
    filePath: '/path/to/avatar.png',
  },
});
console.log(result); // { uploaded: ['/path/to/avatar.png'] }

// Upload multiple files
await sendCommand({
  action: 'uploadFile',
  params: {
    selector: '[data-testid="document-upload"]',
    filePath: ['/path/to/doc1.pdf', '/path/to/doc2.pdf'],
  },
});

// Error case: not a file input
await sendCommand({
  action: 'uploadFile',
  params: {
    selector: '[data-testid="submit-button"]',
    filePath: '/path/to/file.pdf',
  },
});
// Error: Element is not a file input (type="submit"): [data-testid="submit-button"]
```

## Documentation Update

Add to `how-to-use-puppet.md` Available Commands table:

| Action       | Params                 | Description                            |
| ------------ | ---------------------- | -------------------------------------- |
| `uploadFile` | `selector`, `filePath` | Upload file(s) to a file input element |

### File Upload Example

```javascript
// Single file
await sendCommand({
  action: 'uploadFile',
  params: {
    selector: 'input[type="file"]',
    filePath: '/Users/me/Documents/resume.pdf',
  },
});

// Multiple files
await sendCommand({
  action: 'uploadFile',
  params: {
    selector: '[data-testid="attachments"]',
    filePath: ['./file1.jpg', './file2.jpg'],
  },
});
```
