# Task: Interactive/REPL Mode for Puppet

## Overview

Add the ability to keep a browser session open and send commands on-the-fly, enabling Claude to control the browser interactively without restarting it for each action.

## Problem

Currently, puppet scripts run start-to-finish and close the browser when done. This means:
- Each interaction requires a new browser launch
- No way to send additional commands to an existing session
- Can't inspect page state between commands

## Proposed Solution

Create a session system where:
1. Browser stays open after initial launch
2. Commands can be sent via a watched file or similar mechanism
3. Results are written back for Claude to read

### API Design

```typescript
import { startSession } from 'puppet';

// Start interactive session - browser opens and stays open
const session = await startSession({
  commandFile: '~/.puppet/commands.json',  // Claude writes commands here
  resultFile: '~/.puppet/results.json',    // Results written here
  headless: false,
});

// Session runs until explicitly closed
await session.close();
```

### Command File Format

```json
{
  "id": "cmd-123",
  "action": "type",
  "params": {
    "selector": "input[name='email']",
    "text": "user@example.com"
  }
}
```

### Result File Format

```json
{
  "id": "cmd-123",
  "success": true,
  "result": null,
  "screenshot": "base64...",  // optional
  "error": null
}
```

## Implementation Steps

1. Create `src/session.ts` with:
   - `startSession()` function
   - File watcher for command file
   - Command parser and executor
   - Result writer

2. Support these commands:
   - `goto` - navigate to URL
   - `click` - click element
   - `type` - type into element
   - `scroll` - scroll page
   - `screenshot` - capture screenshot
   - `evaluate` - run JS in page context
   - `waitFor` - wait for selector
   - `close` - end session

3. Add to exports in `src/index.ts`

4. Update Claude skill with interactive mode documentation

## Alternatives Considered

1. **WebSocket server** - More complex, but lower latency
2. **Named pipes** - Unix-only, harder for Claude to use
3. **HTTP server** - Adds network dependency
4. **File watching** - Simple, cross-platform, easy for Claude to use (chosen)

## Success Criteria

- [ ] Browser stays open between commands
- [ ] Commands execute within 100ms of file change
- [ ] Results available for Claude to read
- [ ] Graceful error handling (bad commands don't crash session)
- [ ] Session can be cleanly closed
